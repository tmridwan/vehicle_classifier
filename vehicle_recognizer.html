<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Recognizer</title>
</head>
<body>
    <h1>Vehicle Recognizer</h1>
    <input type="file" id="photo">
<div id="result"></div>
<script type="module">
	import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client@1.4.0/dist/index.min.js";

	const photoInput = document.getElementById('photo');
	const resultDiv = document.getElementById('result');

	photoInput.addEventListener('change', async () => {
		const file = photoInput.files[0];
		if (!file) return;

		resultDiv.innerHTML = 'Analyzing...';

		try {
			const client = await Client.connect("tmridwan03/vehicle_recognizer");
			const result = await client.predict("/predict", { 
				img: file
			});

			// Display results
			if (result.data && result.data.confidences) {
				const confidences = result.data.confidences;
				const sorted = Object.entries(confidences)
					.sort((a, b) => b[1] - a[1])
					.slice(0, 5);

				let html = '<h3>Top Predictions:</h3><ul>';
				sorted.forEach(([label, confidence]) => {
					html += `<li>${label}: ${(confidence * 100).toFixed(1)}%</li>`;
				});
				html += '</ul>';
				resultDiv.innerHTML = html;
			} else {
				resultDiv.innerHTML = '<p>Results: ' + JSON.stringify(result.data) + '</p>';
			}
		} catch (err) {
			resultDiv.innerHTML = `<p style="color:red">Error: ${err.message}</p>`;
			console.error(err);
		}
	});
</script>
</body>
</html>